---
title: "Build Model"
author: "Alex"
date: "9/20/2019"
output: html_document
---

# Load Libraries and connect to board
```{r}
library(tidyverse)
library(tidymodels)
```

# Get data
```{r}
con <- dbConnect(odbc::odbc(), "Content DB")
df <- DBI::dbReadTable(con, "bike_model_data")

train <- df %>%
  mutate(date = as.Date(date))
  filter(date <= max(date))
```

TODO: Add cross-validation, measures of goodness-of-fit
```{r}
set.seed(1028)
cv <- rsample::vfold_cv(df, repeats = 10, strata = id)
```

Make recipe for model
```{r}
train_mat <- recipe(n_bikes ~ ., data = select(df, -date)) %>%
  step_dummy(id, dow) %>%
  prep(df) %>%
  bake(df, all_predictors())




mod <- xgboost::xgboost(data = train_mat, label = df$n_bikes, nrounds = 15)
```

```{r}
pins::pin(mod, "bike_available_model", 
          "Model of Capitol Citybikes Available per Station", 
          board = "rsconnect")
```

